resolver 127.0.0.11 valid=10s;

server {
    listen 80;
    server_name 51.77.144.54 vps-d6ab33ba.vps.ovh.net;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    client_max_body_size 50M;

    set $frontend_upstream http://frontend:3000;
    set $ctg_upstream http://ctg-monitor:8000;
    set $apgar_upstream http://apgar-transition:8001;
    set $prenatal_upstream http://prenatal-followup:8010;

    location / {
        proxy_pass $frontend_upstream;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass $frontend_upstream;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ctg-monitor {
        proxy_pass $ctg_upstream/api/ctg-monitor;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/apgar {
        proxy_pass $apgar_upstream/api/apgar-transition;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/prenatal-followup {
        proxy_pass $prenatal_upstream;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
